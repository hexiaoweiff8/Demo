$(function(){var a=$.parseGet("source"),b=a?a:"jrm",c="",d=$.parseGet("sid"),e={urlBridgev2:"http://minner.jr.jd.com/godQA/jsmin/bridgev2.min.js",urlGetTopicList:"http://msinner.jr.jd.com/jj/h5/comment/getTopicList.action?source="+b,urlSayGoodTopic:"http://msinner.jr.jd.com/jj/h5/comment/sayGoodTopic.action?source="+b,urlLogin:"http://passport.m.jd.com/user/login.action?source="+b,urlGodQa:"http://minner.jr.jd.com/godQA/godQA.html?source="+b,urlGodTopic:"http://minner.jr.jd.com/godQA/godTopic.html?source="+b,urlToAnswer:"http://minner.jr.jd.com/godQA/godToAnswer.html?source="+b,urlToQuestion:"http://minner.jr.jd.com/godQA/godToQuestion.html?source="+b};"app"===b&&(c="loading",$.asyncLoadScript(e.urlBridgev2,function(){c="loaded",window.oBridgeV2||(window.oBridgeV2=jsBridgeV2&&new jsBridgeV2(function(a){"string"==typeof a&&(a=JSON.parse(a)),"data"in a&&(window.location.href=window.appUrlLoginBack+"&sid="+$.base64encode(decodeURIComponent(a.data)))})),window.oBridgeV2&&window.oBridgeV2.jsToNaWeiXin({isShow:!1,optionType:1,btnText:"",shareDate:{appId:"",img:"",link:"",desc:"",title:"",friendesc:"",type:""}})}));var f=$("#god_nav"),g=f.find("ul li"),h=$.parseGet("godType"),i=null;switch(h){case"1":g.eq(0).addClass("active"),i=1;break;case"2":g.eq(1).addClass("active"),i=2;break;default:g.eq(0).addClass("active"),i=1}g.tap(function(){var a=$(this),b=a.index(),c=++b;a.addClass("active").siblings("li").removeClass("active"),k.hide(),j.$qaListContainer.html('<div class="loading"><div class="loading-bold-i"></div><div class="loading-bold-o"></div><div class="loading-text">加载中...</div></div>'),j.pageType=c,j.pageNum=1,j.getQAList(function(){j.$qaListContainer.html("")})});var j={$qaListContainer:$("#god_qa_list"),pageType:i,pageNum:1,pageSize:20,maxContentLength:64,getId:0,getQAList:function(a){var b=++j.getId;$.ajax({type:"GET",url:e.urlGetTopicList,dataType:"jsonp",data:{pageType:j.pageType,pageNum:j.pageNum,pageSize:j.pageSize},success:function(c){b===j.getId&&(a&&a(),"string"==typeof c&&(c=JSON.parse(c)),j.renderQaList(c))}})},renderQaList:function(a){for(var b=a.resultData&&a.resultData.topicList,c="",d=0,e=b.length||0;e>d;d++){var f=b[d],g=f.topDiscussVo,h=f.replys,i="",l=$.parseContent(f.topicContent,j.maxContentLength);if(h>0&&g){var m=1===parseInt(g.myLike)?!0:!1,n=$.parseContent(g.content,j.maxContentLength);i+='<section class="qa-list-a"><div class="qa-avatar"><img src="'+g.yunSmaImageUrl+'"/></div><div class="a-info"><span class="a-time">'+$.parseMillisecond(g.createTime)+'</span><span class="a-name">'+g.nicknameShow+'</span></div><div class="a-content qa-to-reveal" data-rid="'+g.discussionId+'"><i class="corner"></i><p>'+n.sliceContent+'</p><div class="like"><div class="to-like"><i class="like-icon  '+(m?"active":"")+'"></i><span>'+g.likeCount+'</span></div></div></div><div class="a-content-data dn" data-pic="'+g.pictureUrl+'">'+n.decodeContent+"</div></section>"}else i+='<section class="qa-list-a"><div class="qa-avatar"><img src="./img/defaultAvatar.png"/></div><div class="a-content qa-to-answer"><i class="corner"></i><p><i class="add"></i>我要回答...</p></div></section>';c+='<article class="qa-list-wrap"><section class="qa-list-q"><div class="qa-avatar"><img src="'+f.yunSmaImageUrl+'"/></div><div class="q-info">'+f.nicknameShow+'<span class="q-time">'+$.parseMillisecond(f.createTime)+'</span></div><div class="q-content" data-tid="'+f.topicId+'"><i class="corner"></i><p>'+l.sliceContent+'</p><i class="next"></i></div></section>'+i+"</article>"}$(c).appendTo(j.$qaListContainer),k.show(),""==c?k.addClass("active").text("无更多内容"):k.removeClass("active").text("点击加载更多")}};j.getQAList(function(){j.$qaListContainer.html("")});var k=$("#god_qa_more");k.tap(function(){var a=$(this);a.hasClass("active")||(a.addClass("active").initDottedLoading("加载中"),j.pageNum++,j.getQAList())}),j.$qaListContainer.delegate(".to-like","tap",function(){var a=$(this),f=a.children(".like-icon ");if(!f.hasClass("lock")){if(f.addClass("lock"),f.hasClass("active"))$.emitNotification("这条回答已经点过赞啦"),f.removeClass("lock");else{var g=a.parents(".a-content").data("rid");""==d?(window.appUrlLoginBack=e.urlGodQa,$.gonnaLogin(b,{accessViaWeb:e.urlLogin,urlBridgev2:e.urlBridgev2},function(){return c})):$.ajax({type:"GET",url:e.urlSayGoodTopic,dataType:"jsonp",data:{replyId:g,sid:d},success:function(d){if("string"==typeof d&&(d=JSON.parse(d)),3===d.resultCode)window.appUrlLoginBack=e.urlGodQa,$.gonnaLogin(b,{accessViaWeb:e.urlLogin,urlBridgev2:e.urlBridgev2},function(){return c});else if(f.addClass("active"),d.resultData.result){var g=a.children("span");g.text(parseInt(g.text())+1)}else $.emitNotification("这条回答已经点过赞啦");f.removeClass("lock")}})}return!1}}),j.$qaListContainer.delegate(".q-content","tap",function(){window.location.href=e.urlGodTopic+"&tid="+$(this).data("tid")+"&sid="+d}),j.$qaListContainer.delegate(".qa-to-answer","tap",function(){var a=$(this),f=a.parents(".qa-list-wrap").find(".q-content").data("tid");""==d?(window.appUrlLoginBack=e.urlToAnswer+"&tid="+f,$.gonnaLogin(b,{accessViaWeb:e.urlLogin,urlBridgev2:e.urlBridgev2},function(){return c})):window.location.href=e.urlToAnswer+"&tid="+f+"&sid="+d}),$("#god_q").bind("tap",function(){""==d?(window.appUrlLoginBack=e.urlToQuestion,$.gonnaLogin(b,{accessViaWeb:e.urlLogin,urlBridgev2:e.urlBridgev2},function(){return c})):window.location.href=e.urlToQuestion+"&sid="+d}),j.$qaListContainer.delegate(".qa-to-reveal > p","tap",function(){var a=$(this),b=a.parents(".qa-to-reveal"),c=b.siblings(".qa-avatar").children("img").attr("src"),d=b.siblings(".a-info"),e=d.children(".a-name").text(),f=d.children(".a-time").text(),g=b.siblings(".a-content-data"),h=g.html(),i=g.data("pic");$.revealAnswer(c,e,f,h,i)})});