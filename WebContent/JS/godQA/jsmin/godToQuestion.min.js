$(function(){function a(){var a=parseInt($(".god-to-question").css("padding-top")),c=$(window).height(),d=n.height(),e=l.height(),f=Math.ceil(5*a+d+e+6);r=c-f,b()}function b(){var a=j.val().trim().length;k.text(j.val());var b=k.height();j.height(r>b?b:r),m.text(a),a>100?m.addClass("warning"):m.removeClass("warning")}var c=$.parseGet("source"),d=c?c:"jrm",e="",f=$.parseGet("sid"),g={urlBridgev2:"http://minner.jr.jd.com/godQA/jsmin/bridgev2.min.js",urlSaveTopic:"http://msinner.jr.jd.com/jj/h5/comment/saveTopic.action?source="+d,urlLogin:"http://passport.m.jd.com/user/login.action?source="+d,urlGodQa:"http://minner.jr.jd.com/godQA/godQA.html?source="+d,urlToQuestion:"http://minner.jr.jd.com/godQA/godToQuestion.html?source="+d};"app"===d&&(e="loading",$.asyncLoadScript(g.urlBridgev2,function(){e="loaded",window.oBridgeV2||(window.oBridgeV2=jsBridgeV2&&new jsBridgeV2(function(a){"string"==typeof a&&(a=JSON.parse(a)),"data"in a&&(window.location.href=window.appUrlLoginBack+"&sid="+$.base64encode(decodeURIComponent(a.data)))})),window.oBridgeV2&&window.oBridgeV2.jsToNaWeiXin({isShow:!1,optionType:1,btnText:"",shareDate:{appId:"",img:"",link:"",desc:"",title:"",friendesc:"",type:""}})}));var h=$("#q_type"),i=h.children("div"),j=$("#god_to_question"),k=$(".t-measure div"),l=$(".to-question-assets"),m=l.find(".word-count"),n=$("#god_to_sub"),o="placeholder"in document.createElement("input");if(!o){var p=j.attr("placeholder"),q=j.val();j.bind("focus",function(){j.val()===p&&j.val("")}),j.bind("blur",function(){""===j.val()&&j.val(p)}),q||j.val(p)}i.tap(function(){i.removeClass("active"),$(this).addClass("active")});var r=0;a(),$(window).resize(a),j.bind("input",b),n.tap(function(){var a=$(this);if(!a.hasClass("lock")){var b=h.children(".active").data("val"),c=j.val().trim();""==c?($.emitNotification("抱歉，提问内容不能为空"),j.focus()):m.hasClass("warning")?($.emitNotification("提问内容不能超过100字"),j.focus()):(a.addClass("lock").initDottedLoading("发布中"),$.ajax({type:"GET",url:g.urlSaveTopic,dataType:"jsonp",data:{systemId:0,sid:f,key:b,content:c},success:function(b){"string"==typeof b&&(b=JSON.parse(b)),3===b.resultCode?(window.appUrlLoginBack=g.urlToQuestion,$.gonnaLogin(d,{accessViaWeb:g.urlLogin,urlBridgev2:g.urlBridgev2},function(){return e})):b.resultData&&b.resultData.result?$.emitNotification("发布成功",function(){window.location.href=g.urlGodQa+"&godType=2&sid="+f}):($.emitNotification(b.resultData&&b.resultData.msg||"发布失败，请检查网络后，重新尝试"),a.removeClass("lock"),a.text("发布"))}}))}})});