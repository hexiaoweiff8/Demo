$(function(){var a=$.parseGet("source"),b=a?a:"jrm",c="",d=$.parseGet("sid"),e={urlBridgev2:"http://minner.jr.jd.com/godQA/jsmin/bridgev2.min.js",urlShareAvatar:"http://minner.jr.jd.com/godQA/img/shareAvatar.png",urlGetOneTopic:"http://msinner.jr.jd.com/jj/h5/comment/getOneTopic.action?source="+b,urlSayGoodTopic:"http://msinner.jr.jd.com/jj/h5/comment/sayGoodTopic.action?source="+b,urlLogin:"http://passport.m.jd.com/user/login.action?source="+b,urlGodTopic:"http://minner.jr.jd.com/godQA/godTopic.html?source="+b,urlToAnswer:"http://minner.jr.jd.com/godQA/godToAnswer.html?source="+b};"app"===b&&(c="loading",$.asyncLoadScript(e.urlBridgev2,function(){c="loaded",$.waitFor(function(){return window.firstRenderShootDone},function(){window.oBridgeV2||(window.oBridgeV2=jsBridgeV2&&new jsBridgeV2(function(a){"string"==typeof a&&(a=JSON.parse(a)),"data"in a&&(window.location.href=window.appUrlLoginBack+"&sid="+$.base64encode(decodeURIComponent(a.data)))}));var a=f.$qaListContainer.find(".q-content").children("p").text();window.oBridgeV2&&window.oBridgeV2.jsToNaWeiXin({isShow:!0,optionType:1,btnText:"分享",shareDate:{appId:"",img:e.urlShareAvatar,link:e.urlGodTopic.split("?source=")[0]+"?tid="+f.tid,desc:a,title:"财神问答",friendesc:a,type:""}})})}));var f={$qaListContainer:$("#god_qa_list"),tid:$.parseGet("tid"),pageNum:1,pageSize:10,maxContentLength:64,getQAList:function(a){f.tid?$.ajax({type:"GET",url:e.urlGetOneTopic,dataType:"jsonp",data:{topNum:f.tid,pageNum:f.pageNum,pageSize:f.pageSize},success:function(b){a&&a(),"string"==typeof b&&(b=JSON.parse(b)),f.renderQaList(b)}}):$.emitNotification("无法获取到主题内容")},renderQaList:function(a){var b=a.resultData&&a.resultData.topic,c=a.resultData&&a.resultData.count,d="",e="";if(c>0)for(var h=b.discussionVoList,i=0,j=h.length;j>i;i++){var k=h[i],l=1===parseInt(k.myLike)?!0:!1,m=(f.pageNum-1)*f.pageSize+i+1,n=$.parseContent(k.content,f.maxContentLength);e+='<section class="qa-list-a"><div class="qa-avatar"><img src="'+k.yunSmaImageUrl+'"/></div><div class="a-info"><span class="a-time">'+$.parseMillisecond(k.createTime)+'</span><span class="a-name">'+k.nicknameShow+'</span></div><div class="a-content" data-rid="'+k.discussionId+'"><i class="corner"></i><p>'+n.sliceContent+'</p><div class="like"><div class="floor">'+m+'楼</div><div class="to-like"><i class="like-icon  '+(l?"active":"")+'"></i><span>'+k.likeCount+'</span></div></div></div><div class="a-content-data dn" data-pic="'+k.pictureUrl+'">'+n.decodeContent+"</div></section>"}else e='<section class="qa-first-a"><img src="./img/firstAnswer.jpg"/></section>';if(1===f.pageNum)if(b.topicContent=$.parseContent(b.topicContent).decodeContent,d+='<article class="qa-list-wrap"><section class="qa-list-q"><div class="qa-avatar"><img src="'+b.yunSmaImageUrl+'"/></div><div class="q-info">'+b.nicknameShow+'<span class="q-time">'+$.parseMillisecond(b.createTime)+'</span></div><div class="q-content"><i class="corner"></i><p>'+b.topicContent+"</p></div></section>"+e+"</article>",$(d).appendTo(f.$qaListContainer),c<=f.pageSize&&g.addClass("active").text("无更多回答"),c>0)g.show();else{var o=f.$qaListContainer.find(".qa-list-q"),p=$("#god_q"),q=f.$qaListContainer.find(".qa-first-a"),r=$(window).width()/2*1.6,s=o.height(),t=p.height(),u=$(window).height(),v=parseInt(o.css("margin-top")),w=u-r-s-t-.5*v;w>0&&q.css("margin-top",w+"px")}else $(e).appendTo(f.$qaListContainer.children(".qa-list-wrap")),""==e?g.addClass("active").text("无更多回答"):g.removeClass("active").text("点击加载更多");window.firstRenderShootDone=!0}};f.getQAList(function(){f.$qaListContainer.html("")});var g=$("#god_qa_more");g.tap(function(){var a=$(this);a.hasClass("active")||(a.addClass("active").initDottedLoading("加载中"),f.pageNum++,f.getQAList())}),f.$qaListContainer.delegate(".to-like","tap",function(){var a=$(this),g=a.children(".like-icon ");if(!g.hasClass("lock")){if(g.addClass("lock"),g.hasClass("active"))$.emitNotification("这条回答已经点过赞啦"),g.removeClass("lock");else{var h=a.parents(".a-content").data("rid");""==d?(window.appUrlLoginBack=e.urlGodTopic+"&tid="+f.tid,$.gonnaLogin(b,{accessViaWeb:e.urlLogin,urlBridgev2:e.urlBridgev2},function(){return c})):$.ajax({type:"GET",url:e.urlSayGoodTopic,dataType:"jsonp",data:{replyId:h,sid:d},success:function(d){if("string"==typeof d&&(d=JSON.parse(d)),3===d.resultCode)window.appUrlLoginBack=e.urlGodTopic+"&tid="+f.tid,$.gonnaLogin(b,{accessViaWeb:e.urlLogin,urlBridgev2:e.urlBridgev2},function(){return c});else if(g.addClass("active"),d.resultData.result){var h=a.children("span");h.text(parseInt(h.text())+1)}else $.emitNotification("这条回答已经点过赞啦");g.removeClass("lock")}})}return!1}}),f.$qaListContainer.delegate(".a-content > p","tap",function(){var a=$(this),b=a.parents(".a-content"),c=b.siblings(".qa-avatar").children("img").attr("src"),d=b.siblings(".a-info"),e=d.children(".a-name").text(),f=d.children(".a-time").text(),g=b.siblings(".a-content-data"),h=g.html(),i=g.data("pic");$.revealAnswer(c,e,f,h,i)}),$("#god_q").bind("tap",function(){""==d?(window.appUrlLoginBack=e.urlToAnswer+"&tid="+f.tid,$.gonnaLogin(b,{accessViaWeb:e.urlLogin,urlBridgev2:e.urlBridgev2},function(){return c})):window.location.href=e.urlToAnswer+"&tid="+f.tid+"&sid="+d})});